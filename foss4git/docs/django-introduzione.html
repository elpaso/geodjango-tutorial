<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
<meta name="version" content="S5 1.1" />
<title>Django: Web Application Framework</title>
<style type="text/css">

.highlight .hll { background-color: #333333 }
.highlight  { background: #111111; color: #ffffff }
.highlight .c { color: #008800; font-style: italic; background-color: #0f140f } /* Comment */
.highlight .err { color: #ffffff } /* Error */
.highlight .g { color: #ffffff } /* Generic */
.highlight .k { color: #fb660a; font-weight: bold } /* Keyword */
.highlight .l { color: #ffffff } /* Literal */
.highlight .n { color: #ffffff } /* Name */
.highlight .o { color: #ffffff } /* Operator */
.highlight .x { color: #ffffff } /* Other */
.highlight .p { color: #ffffff } /* Punctuation */
.highlight .cm { color: #008800; font-style: italic; background-color: #0f140f } /* Comment.Multiline */
.highlight .cp { color: #ff0007; font-weight: bold; font-style: italic; background-color: #0f140f } /* Comment.Preproc */
.highlight .c1 { color: #008800; font-style: italic; background-color: #0f140f } /* Comment.Single */
.highlight .cs { color: #008800; font-style: italic; background-color: #0f140f } /* Comment.Special */
.highlight .gd { color: #ffffff } /* Generic.Deleted */
.highlight .ge { color: #ffffff } /* Generic.Emph */
.highlight .gr { color: #ffffff } /* Generic.Error */
.highlight .gh { color: #ffffff; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #ffffff } /* Generic.Inserted */
.highlight .go { color: #444444; background-color: #222222 } /* Generic.Output */
.highlight .gp { color: #ffffff } /* Generic.Prompt */
.highlight .gs { color: #ffffff } /* Generic.Strong */
.highlight .gu { color: #ffffff; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #ffffff } /* Generic.Traceback */
.highlight .kc { color: #fb660a; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #fb660a; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #fb660a; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #fb660a } /* Keyword.Pseudo */
.highlight .kr { color: #fb660a; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #cdcaa9; font-weight: bold } /* Keyword.Type */
.highlight .ld { color: #ffffff } /* Literal.Date */
.highlight .m { color: #0086f7; font-weight: bold } /* Literal.Number */
.highlight .s { color: #0086d2 } /* Literal.String */
.highlight .na { color: #ff0086; font-weight: bold } /* Name.Attribute */
.highlight .nb { color: #ffffff } /* Name.Builtin */
.highlight .nc { color: #ffffff } /* Name.Class */
.highlight .no { color: #0086d2 } /* Name.Constant */
.highlight .nd { color: #ffffff } /* Name.Decorator */
.highlight .ni { color: #ffffff } /* Name.Entity */
.highlight .ne { color: #ffffff } /* Name.Exception */
.highlight .nf { color: #ff0086; font-weight: bold } /* Name.Function */
.highlight .nl { color: #ffffff } /* Name.Label */
.highlight .nn { color: #ffffff } /* Name.Namespace */
.highlight .nx { color: #ffffff } /* Name.Other */
.highlight .py { color: #ffffff } /* Name.Property */
.highlight .nt { color: #fb660a; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #fb660a } /* Name.Variable */
.highlight .ow { color: #ffffff } /* Operator.Word */
.highlight .w { color: #888888 } /* Text.Whitespace */
.highlight .mf { color: #0086f7; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #0086f7; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0086f7; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #0086f7; font-weight: bold } /* Literal.Number.Oct */
.highlight .sb { color: #0086d2 } /* Literal.String.Backtick */
.highlight .sc { color: #0086d2 } /* Literal.String.Char */
.highlight .sd { color: #0086d2 } /* Literal.String.Doc */
.highlight .s2 { color: #0086d2 } /* Literal.String.Double */
.highlight .se { color: #0086d2 } /* Literal.String.Escape */
.highlight .sh { color: #0086d2 } /* Literal.String.Heredoc */
.highlight .si { color: #0086d2 } /* Literal.String.Interpol */
.highlight .sx { color: #0086d2 } /* Literal.String.Other */
.highlight .sr { color: #0086d2 } /* Literal.String.Regex */
.highlight .s1 { color: #0086d2 } /* Literal.String.Single */
.highlight .ss { color: #0086d2 } /* Literal.String.Symbol */
.highlight .bp { color: #ffffff } /* Name.Builtin.Pseudo */
.highlight .vc { color: #fb660a } /* Name.Variable.Class */
.highlight .vg { color: #fb660a } /* Name.Variable.Global */
.highlight .vi { color: #fb660a } /* Name.Variable.Instance */
.highlight .il { color: #0086f7; font-weight: bold } /* Literal.Number.Integer.Long */

</style>
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<script src="ui/django/slides.js" type="text/javascript"></script>
<link rel="stylesheet" href="ui/django/slides.css"
      type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="ui/django/outline.css"
      type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="ui/django/print.css"
      type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="ui/django/opera.css"
      type="text/css" media="projection" id="operaFix" />

<style type="text/css">
#currentSlide {display: none;}
</style>
</head>
<body>
<div class="layout">
<div id="controls"></div>
<div id="currentSlide"></div>
<div id="header">

</div>
<div id="footer">
<h1>Django: Web Application Framework</h1>
<h2>Alessandro Pasotti - www.itopen.it</h2>
</div>
</div>
<div class="presentation">
<div class="slide" id="slide0">
<h1 class="title">Django: Web Application Framework</h1>

<blockquote>
Un framework per i perfezionisti con delle scadenze</blockquote>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">django</span>
</pre></div>
<ul class="incremental simple">
<li>Introduzione</li>
<li>MVC/MVT</li>
<li>Ciao Mondo!</li>
<li>ORM API</li>
</ul>

</div>
<div class="slide" id="cos-e-un-framework">
<h1>Cos'è un framework?</h1>
<blockquote>
Un insieme di componenti software
per costruire rapidamente applicativi</blockquote>
<ul class="incremental simple">
<li>DRY</li>
<li>Best Practices e Design Patterns</li>
<li>Convenzioni e configurazioni</li>
</ul>
</div>
<div class="slide" id="perche-django">
<h1>Perché Django?</h1>
<ul class="incremental simple">
<li>Comunità di utenti</li>
<li>Documentazione eccellente</li>
<li>Codice pulito, modulare</li>
<li>Poca magia e niente lacci</li>
<li>ORM eccezionale</li>
<li>Scaffolding? No grazie.</li>
</ul>
</div>
<div class="slide" id="componenti-del-framework-django">
<h1>Componenti del framework Django</h1>
<ul class="incremental simple">
<li>ORM</li>
<li>Templates</li>
<li>Dispatcher</li>
</ul>
<p class="incremental">... più tutta una serie di utilità, per esempio:</p>
<ul class="incremental simple">
<li>Forms</li>
<li>Sessioni</li>
<li>Autenticazione</li>
<li>Pannello di amministrazione</li>
<li>i18n</li>
</ul>
</div>
<div class="slide" id="il-pattern-mvc">
<h1>Il pattern MVC</h1>
<div class="figure align-center">
<img alt="images/mvc.png" src="images/mvc.png" style="width: 400.0px; height: 377.6px;" />
<p class="caption">MVC: <strong>Model</strong> - <strong>View</strong> - <strong>Controller</strong></p>
</div>
</div>
<div class="slide" id="mvc-alla-django-mvt">
<h1>MVC alla Django: MVT</h1>
<blockquote>
Django usa il pattern <strong>Model</strong> - <strong>View</strong> - <strong>Template</strong></blockquote>
<p>È essenzialmente un pattern <strong>Model</strong> - <strong>View</strong> - <strong>Controller</strong>
con una terminologia leggermente diversa</p>
<table border="1" class="center docutils">
<colgroup>
<col width="23%" />
<col width="26%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head" colspan="2">Pattern</th>
<th class="head">&nbsp;</th>
</tr>
<tr><th class="head">MVC</th>
<th class="head">Django MVT</th>
<th class="head">Componente</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Model</td>
<td>Model</td>
<td>ORM</td>
</tr>
<tr><td>View</td>
<td>Template</td>
<td>Template</td>
</tr>
<tr><td>Controller</td>
<td>View</td>
<td>Dispatcher, urls e views</td>
</tr>
</tbody>
</table>
</div>
<div class="slide" id="progetti-e-applicazioni">
<h1>Progetti e applicazioni</h1>
<p>In gergo Django:</p>
<ul class="incremental simple">
<li>applicazione web: <strong>project</strong></li>
<li>componente o modulo: <strong>app</strong></li>
</ul>
<p class="incremental">Django ci mette a disposizione una serie di
comandi per compiere le più comuni operazioni
di gestione e creazione di una applicazione web.</p>
</div>
<div class="slide" id="progetto-creazione">
<h1>Progetto: creazione</h1>
<p>Per creare un nuovo progetto (vuoto) si utilizza il comando <strong>startproject</strong>:</p>
<div class="highlight"><pre><span class="nv">$ </span>django-admin.py startproject workshop
<span class="nv">$ </span><span class="nb">cd </span>workshop/
<span class="nv">$ </span>tree
.
|-- __init__.py
|-- manage.py
|-- settings.py
<span class="sb">`</span>-- urls.py
</pre></div>
</div>
<div class="slide" id="configurazione">
<h1>Configurazione</h1>
<div class="sidebar">
<p class="first sidebar-title">Backend disponibili</p>
<ul class="last simple">
<li>Postgresql</li>
<li>Oracle</li>
<li>MySQL</li>
<li>SqLite</li>
</ul>
</div>
<div class="container">
<div class="highlight"><pre><span class="nv">$ </span>vim settings.py
</pre></div>
<ul class="incremental simple">
<li>Scelta lingua e TZ</li>
<li>Scelta backend</li>
</ul>
<p class="incremental">-&gt; Alessandro Furieri</p>
</div>
</div>
<div class="slide" id="componenti-app">
<h1>Componenti: app</h1>
<p>Le <strong>app</strong> sono i componenti, o moduli (possibilmente
riutilizzabili) che compongono il nostro progetto.</p>
<p>Quasi tutte le funzionalità di Django sono disponibili
sotto forma di <strong>app</strong>.</p>
<div class="highlight"><pre><span class="nv">$ </span>python manage.py startapp ciaomondo
<span class="nv">$ </span>tree
.
|-- __init__.py
|-- manage.py
|-- ciaomondo
|   |-- __init__.py
|   |-- models.py
|   |-- tests.py
|   <span class="sb">`</span>-- views.py
|-- settings.py
<span class="sb">`</span>-- urls.py
</pre></div>
</div>
<div class="slide" id="il-controller">
<h1>Il controller</h1>
<p>Il controller instrada le richieste dei client verso le
viste (<em>views</em>) dei diversi componenti (<em>app</em>)</p>
<p>La configurazione delle rotte avviene tramite espressioni regolari
nei file convenzionalmente chiamati <strong>urls.py</strong></p>
<div class="highlight"><pre><span class="nv">$ </span>cat urls.py
</pre></div>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;nome&gt;\w+)$&#39;</span><span class="p">,</span> <span class="s">&#39;ciaomondo.views.default&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="s">&#39;ciaomondo.views.default&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
<p>La rotta collega l'url alla vista di nome <em>default</em>.</p>
</div>
<div class="slide" id="le-rotte-dei-componenti">
<h1>Le rotte dei componenti</h1>
<div class="sidebar">
<p class="first sidebar-title">I riferimenti alle viste</p>
<p class="last">All'interno della funzione <em>url</em> le viste
possono essere specificate sia come stringhe
sia come <em>callable</em></p>
</div>
<p>Le rotte del progetto generalmente delegano ai file <strong>urls.py</strong>
dei componenti</p>
<div class="highlight"><pre><span class="nv">$ </span>cat urls.py
</pre></div>
<div class="highlight"><pre><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s">r&#39;^ciaomondo$&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">&#39;ciaomondo.urls&#39;</span><span class="p">)),</span>
<span class="p">)</span>
</pre></div>
<p>La rotta include il file <strong>urls.py</strong> del componente</p>
<div class="highlight"><pre><span class="nv">$ </span>cat ciaomondo/urls.py
</pre></div>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^.*$&#39;</span><span class="p">,</span> <span class="s">&#39;ciaomondo.views.default&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="s">&#39;ciaomondo.views.default&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="slide" id="le-viste">
<h1>Le viste</h1>
<div class="sidebar">
<p class="first sidebar-title">Viste generiche</p>
<p>Django ci fornisce diverse viste generiche, pronte da usare per i casi più frequenti:</p>
<ul class="last simple">
<li>lista/dettaglio</li>
<li>anno/mese/giorno</li>
</ul>
</div>
<p>Le viste in Django hanno un'importanza più
limitata rispetto al classico pattern <strong>MVC</strong>,
generalmente si limitano a chiamare i metodi del modello
per manipolarlo o interrogarlo e a passare al template
le variabili corrette.</p>
<div class="highlight"><pre><span class="nv">$ </span>cat ciaomondo/views.py
</pre></div>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span>

<span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">nome</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;default.html&#39;</span><span class="p">,</span>
                            <span class="p">{</span> <span class="s">&#39;nome&#39;</span> <span class="p">:</span> <span class="n">nome</span><span class="p">})</span>
</pre></div>
</div>
<div class="slide" id="i-template">
<h1>I template</h1>
<blockquote>
Django possiede un sistema di template estremamente
versatile, tanto da poter sostituire in buona parte
le viste.</blockquote>
<dl class="docutils">
<dt>variabili</dt>
<dd>{{ nome_variabile }}</dd>
<dt>template tags</dt>
<dd>{% nome_template_tag argomenti %}</dd>
<dt>filtri</dt>
<dd>{{ nome_variabile|iriencode }}</dd>
</dl>
</div>
<div class="slide" id="template-variabili">
<h1>Template: variabili</h1>
<blockquote>
Le variabili possono anche essere array o nomi di metodi senza argomenti.</blockquote>
<dl class="docutils">
<dt>{{ my_object.get_absolute_url }}</dt>
<dd>get_absolute_url viene prima valutato come attributo, quindi come metodo</dd>
<dt>{{ my_object.children.0 }}</dt>
<dd>ritorna il primo elemento della proprietà children, che è una lista</dd>
</dl>
</div>
<div class="slide" id="template-tags">
<h1>Template: tags</h1>
<blockquote>
I tags predefiniti consentono di eseguire istruzioni condizionali e cicli.
È anche possibile creare tag personalizzati.</blockquote>
<div class="highlight"><pre><span class="nt">&lt;ul&gt;</span>
{% for animale in elenco_animali %}
    <span class="nt">&lt;li&gt;</span>{{ animale.nome }}<span class="nt">&lt;/li&gt;</span>
{% empty %}
    <span class="nt">&lt;li&gt;</span>Nessun animale in elenco.<span class="nt">&lt;/li&gt;</span>
{% endfor %}
<span class="nt">&lt;/ul&gt;</span>
</pre></div>
</div>
<div class="slide" id="il-debug">
<h1>Il debug</h1>
<div class="sidebar">
<p class="first sidebar-title">Debug e log</p>
<blockquote>
<p>È possibile anche utilizzare
il log standard di python o
usare il debugger di  <em>ipython</em>
al posto di <em>pdb</em></p>
<p>Django in modalità DEBUG
stampa a video uno stack
trace degli errori.</p>
</blockquote>
<div class="last"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pdb</span>
<span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
</pre></div>
</div></div>
</div>
<div class="slide" id="i-modelli">
<h1>I modelli</h1>
<blockquote>
Il modello descrive una classe di oggetti. A parte
i modelli astratti, tutti i modelli vengono mappati
su una tabella nel database.</blockquote>
<p>Sono disponibili tutti i tipi di campi normalmente
supportati dai <em>backend</em> RDBMS, per esempio:</p>
<ul class="simple">
<li>BooleanField</li>
<li>TextField</li>
<li>DateField</li>
<li>FloatField</li>
<li>DecimalField</li>
<li>...</li>
</ul>
</div>
<div class="slide" id="i-modelli-campi-speciali">
<h1>I modelli: campi &quot;speciali&quot;</h1>
<p>... ci sono anche campi <em>speciali</em> ...</p>
<ul class="simple">
<li>EmailField</li>
<li>FileField</li>
<li>ImageField</li>
<li>IPAddressField</li>
<li>SlugField</li>
<li>URLField</li>
<li>CommaSeparatedIntegerField</li>
<li>...</li>
</ul>
</div>
<div class="slide" id="i-modelli-campi-geo">
<h1>I modelli: campi &quot;geo&quot;</h1>
<p>... e i campi <em>GEO</em>, disponibili in <strong>GeoDjango</strong></p>
<ul class="simple">
<li>PointField</li>
<li>LineStringField</li>
<li>PolygonField</li>
<li>MultiPointField</li>
<li>MultiLineStringField</li>
<li>MultiPolygonField</li>
<li>GeometryCollectionField</li>
</ul>
<p>... e il nuovo <em>GeometryField</em></p>
</div>
<div class="slide" id="un-semplice-modello">
<h1>Un semplice modello</h1>
<blockquote>
Un modello per rappresentare avvistamenti di animali.</blockquote>
<div class="sidebar">
<p class="first sidebar-title">Animali</p>
<img alt="images/foto/lupo.jpg" src="images/foto/lupo.jpg" style="width: 102.4px; height: 76.8px;" />
<img alt="images/foto/volpe.jpg" src="images/foto/volpe.jpg" style="width: 100.2px; height: 66.8px;" />
<img alt="images/foto/orso.jpg" class="last" src="images/foto/orso.jpg" style="width: 102.4px; height: 81.0px;" />
</div>
<dl class="docutils">
<dt>Animale:</dt>
<dd><ul class="first last simple">
<li>nome</li>
</ul>
</dd>
<dt>Avvistamento:</dt>
<dd><ul class="first last simple">
<li>animale (chiave esterna)</li>
<li>data</li>
</ul>
</dd>
</dl>
</div>
<div class="slide" id="id1">
<h1>Un semplice modello</h1>
<div class="highlight"><pre><span class="nv">$ </span>python manage.py startapp fauna
<span class="nv">$ </span><span class="nb">cd </span>fauna <span class="o">&amp;&amp;</span> vim models.py
</pre></div>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Animale</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Modello per rappresentare gli animali&quot;&quot;&quot;</span>
    <span class="n">nome</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nome</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Avvistamento</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Modello per gli avvistamenti&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">animale</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Animale</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> - </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">animale</span><span class="p">)</span>
</pre></div>
</div>
<div class="slide" id="crazione-automatica-delle-tabelle">
<h1>Crazione automatica delle tabelle</h1>
<div class="highlight"><pre><span class="nv">$ </span>python manage.py sqlall fauna
</pre></div>
<div class="highlight"><pre><span class="k">BEGIN</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">&quot;fauna_animale&quot;</span> <span class="p">(</span>
    <span class="ss">&quot;id&quot;</span> <span class="nb">serial</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="ss">&quot;nome&quot;</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span>
<span class="p">)</span>
<span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">&quot;fauna_avvistamento&quot;</span> <span class="p">(</span>
    <span class="ss">&quot;id&quot;</span> <span class="nb">serial</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="ss">&quot;data&quot;</span> <span class="k">timestamp</span> <span class="k">with</span> <span class="n">time</span> <span class="k">zone</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="ss">&quot;animale_id&quot;</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">REFERENCES</span> <span class="ss">&quot;fauna_animale&quot;</span> <span class="p">(</span><span class="ss">&quot;id&quot;</span><span class="p">)</span>
                    <span class="k">DEFERRABLE</span> <span class="k">INITIALLY</span> <span class="k">DEFERRED</span>
<span class="p">)</span>
<span class="p">;</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="ss">&quot;fauna_avvistamento_animale_id&quot;</span>
                    <span class="k">ON</span> <span class="ss">&quot;fauna_avvistamento&quot;</span> <span class="p">(</span><span class="ss">&quot;animale_id&quot;</span><span class="p">);</span>
<span class="k">COMMIT</span><span class="p">;</span>
</pre></div>
</div>
<div class="slide" id="creazione-db-e-sync">
<h1>Creazione DB e sync</h1>
<blockquote>
I comandi di gestione di Django allineano il DB con
il modello. Unico neo: mancano le migrazioni.</blockquote>
<div class="highlight"><pre><span class="nv">$ </span>createdb -E UTF-8 -T template_postgis fauna
<span class="nv">$ </span>python manage.py syncdb
Creating table fauna_animale
Creating table fauna_avvistamento
Installing index <span class="k">for </span>fauna.Avvistamento model
</pre></div>
</div>
<div class="slide" id="orm-api">
<h1>ORM API</h1>
<blockquote>
Tramite le API di Django possiamo interagire direttamente
con il DB e capire come funziona. Sono disponibili tutte
le operazioni CRUD e di interrogazione</blockquote>
<div class="highlight"><pre><span class="nv">$ </span>python manage.py shell

&gt;&gt;&gt; from fauna.models import *
&gt;&gt;&gt; Animale<span class="o">(</span><span class="nv">nome</span><span class="o">=</span><span class="s1">&#39;Orso&#39;</span><span class="o">)</span>.save<span class="o">()</span>
&gt;&gt;&gt; Animale<span class="o">(</span><span class="nv">nome</span><span class="o">=</span><span class="s1">&#39;Lupo&#39;</span><span class="o">)</span>.save<span class="o">()</span>
&gt;&gt;&gt; <span class="nv">volpe</span><span class="o">=</span>Animale<span class="o">()</span>
&gt;&gt;&gt; volpe.nome<span class="o">=</span><span class="s1">&#39;Volpe&#39;</span>
&gt;&gt;&gt; volpe.save<span class="o">()</span>
&gt;&gt;&gt; volpe.pk
3L
&gt;&gt;&gt; <span class="nv">primate</span> <span class="o">=</span> Animale<span class="o">(</span><span class="nv">nome</span><span class="o">=</span><span class="s1">&#39;Umano&#39;</span><span class="o">)</span>
&gt;&gt;&gt; primate.save<span class="o">()</span>
&gt;&gt;&gt; primate.nome <span class="o">=</span> <span class="s1">&#39;Babbuino&#39;</span>
&gt;&gt;&gt; primate.save<span class="o">()</span>
&gt;&gt;&gt; primate.delete<span class="o">()</span>
</pre></div>
</div>
<div class="slide" id="orm-interrogazione">
<h1>ORM Interrogazione</h1>
<div class="sidebar">
<p class="first sidebar-title">Filtri</p>
<p>È possibile interrogare il DB tramite filtri sui valori dei
campi.</p>
<p class="last">I filtri si costruiscono collegando
il nome del campo con due trattini bassi
(<em>underscore</em>)</p>
</div>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">Animale</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nome</span><span class="o">=</span><span class="s">&#39;Orso&#39;</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">Animale</span><span class="p">:</span> <span class="n">Orso</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Animale</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">Animale</span><span class="p">:</span> <span class="n">Lupo</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Animale</span><span class="p">:</span> <span class="n">Orso</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Animale</span><span class="p">:</span> <span class="n">Volpe</span><span class="o">&gt;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Animale</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">nome__contains</span><span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">)</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">Animale</span><span class="p">:</span> <span class="n">Volpe</span><span class="o">&gt;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Animale</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">nome__icontains</span><span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">)</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">Animale</span><span class="p">:</span> <span class="n">Lupo</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Animale</span><span class="p">:</span> <span class="n">Volpe</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<div class="slide" id="orm-filtri">
<h1>ORM Filtri</h1>
<blockquote>
<p>Il filtri di ricerca nelle interrogazioni permettono
una granularità elevata, è anche possibile cercare nei
valori di tabelle collegate.</p>
<p>Le interrogazioni possono anche essere eseguite sulle istanze.</p>
</blockquote>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">Avvistamento</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">animale</span><span class="o">=</span><span class="n">Animale</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">Avvistamento</span><span class="p">:</span> <span class="n">Orso</span> <span class="o">-</span> <span class="mi">2010</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">27</span> <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">avv</span> <span class="o">=</span> <span class="n">Avvistamento</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">animale__nome</span><span class="o">=</span><span class="s">&#39;Orso&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">avv</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="mi">6</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">avv</span>
<span class="p">[</span><span class="o">&lt;</span><span class="n">Avvistamento</span><span class="p">:</span> <span class="n">Orso</span> <span class="o">-</span> <span class="mi">2010</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">27</span> <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">orso</span><span class="o">=</span><span class="n">Animale</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nome</span><span class="o">=</span><span class="s">&#39;Orso&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">orso</span><span class="o">.</span><span class="n">avvistamento_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">Avvistamento</span><span class="p">:</span> <span class="n">Orso</span> <span class="o">-</span> <span class="mi">2010</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">27</span> <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<div class="slide" id="id2">
<h1>ORM Filtri</h1>
<table border="1" class="borderless docutils">
<colgroup>
<col width="35%" />
<col width="32%" />
<col width="32%" />
</colgroup>
<tbody valign="top">
<tr><td>exact</td>
<td>lte</td>
<td>day</td>
</tr>
<tr><td>iexact</td>
<td>startswith</td>
<td>week_day</td>
</tr>
<tr><td>contains</td>
<td>istartswith</td>
<td>isnull</td>
</tr>
<tr><td>icontains</td>
<td>endswith</td>
<td>search <a class="footnote-reference" href="#id5" id="id3">[1]</a></td>
</tr>
<tr><td>in</td>
<td>iendswith</td>
<td>regex</td>
</tr>
<tr><td>gt</td>
<td>range <a class="footnote-reference" href="#id6" id="id4">[2]</a></td>
<td>iregex</td>
</tr>
<tr><td>gte</td>
<td>year</td>
<td>&nbsp;</td>
</tr>
<tr><td>lt</td>
<td>month</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[1]</a></td><td>solo in MySQL</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[2]</a></td><td>SQL: BETWEEN</td></tr>
</tbody>
</table>
</div>
</div>
</body>
</html>
